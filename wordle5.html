<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BizApp - GÃ¼nlÃ¼k Wordle 5</title>
  <style>
    :root {
      --correct: #6aaa64;
      --present: #c9b458;
      --absent: #3a3a3c;
      --key-bg: #818384;
      --bg: #121213;
      --primary: #ff4d6d;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      padding: 10px;
      height: 100vh;
      justify-content: space-between;
      overflow: hidden;
    }

    .header { width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 10px; z-index: 10; }
    .back-link { color: var(--primary); text-decoration: none; font-weight: bold; }

    #grid { display: grid; grid-template-rows: repeat(6, 1fr); gap: 5px; }
    .row { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; }
    .tile { 
      width: 50px; height: 50px; border: 2px solid #3a3a3c;
      display: flex; align-items: center; justify-content: center;
      font-size: 25px; font-weight: bold; text-transform: uppercase;
      background: transparent;
    }

    .correct { background: var(--correct) !important; border-color: var(--correct) !important; color: white !important; }
    .present { background: var(--present) !important; border-color: var(--present) !important; color: white !important; }
    .absent { background: var(--absent) !important; border-color: var(--absent) !important; color: white !important; }

    #keyboard { width: 100%; max-width: 500px; padding-bottom: 20px; z-index: 10; }
    .kbd-row { display: flex; justify-content: center; gap: 4px; margin-bottom: 8px; }
    .key {
      background: var(--key-bg); border: none; color: white; border-radius: 4px;
      padding: 18px 0; cursor: pointer; font-weight: bold; font-size: 14px;
      flex: 1; text-transform: uppercase; transition: all 0.2s;
    }
    .key.wide { flex: 1.5; }
    .message { color: #ff8fa3; font-weight: bold; height: 20px; margin-bottom: 5px; text-align: center; }

    /* Ã–pÃ¼cÃ¼k Bildirim Stilleri */
    .kiss-notify { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: white; color: var(--primary); padding: 15px 25px; border-radius: 50px; font-weight: bold; box-shadow: 0 10px 25px rgba(255, 77, 109, 0.3); z-index: 9999; display: flex; align-items: center; gap: 10px; animation: slideDown 0.5s ease-out; }
    @keyframes slideDown { from { top: -100px; } to { top: 20px; } }
    .floating-heart { position: fixed; color: var(--primary); pointer-events: none; animation: heartPop 1.5s forwards; z-index: 10000; font-size: 25px; }
    @keyframes heartPop { 0% { transform: scale(0); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateY(-150px) rotate(20deg) scale(1.5); opacity: 0; } }
  </style>
</head>
<body>

  <div class="header">
    <a href="wordle-menu.html" class="back-link">â¬… Geri</a>
    <h2 style="margin:0; color:var(--primary);">GÃ¼nlÃ¼k Wordle</h2>
    <div style="width:40px;"></div>
  </div>

  <div id="message" class="message"></div>
  <div id="grid"></div>

  <div id="keyboard">
    <div class="kbd-row" id="kbd-row1"></div>
    <div class="kbd-row" id="kbd-row2"></div>
    <div class="kbd-row" id="kbd-row3"></div>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, onValue, update, onChildAdded } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AZaSyCwUGShLfuUOSSHSyK0b7HXvPiu45Mtso",
  authDomain: "sadece-biz.firebaseapp.com",
  databaseURL: "https://sadece-biz-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "sadece-biz",
  storageBucket: "sadece-biz.firebasestorage.app",
  messagingSenderId: "868755199002",
  appId: "1:868755199002:web=e8c18eb0cd11abb2292da3"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const room = localStorage.getItem("room") || "genel";
const userId = localStorage.getItem("userId");

// --- Ã–PÃœCÃœK DÄ°NLEME SÄ°STEMÄ° ---
const pageLoadTime = Date.now();
const kissRef = ref(db, "rooms/" + room);

onChildAdded(kissRef, (snapshot) => {
  const data = snapshot.val();
  const sentTime = data.timestamp || data.time || 0;
  if (data.type === 'kiss' && data.sender !== userId && sentTime > pageLoadTime) {
    showKissNotification();
  }
});

function showKissNotification() {
  const notify = document.createElement("div");
  notify.className = "kiss-notify";
  notify.innerHTML = `<span>ðŸ’‹</span> BalÄ±m sana bir Ã¶pÃ¼cÃ¼k gÃ¶nderdi!`;
  document.body.appendChild(notify);
  
  for(let i=0; i<15; i++) {
    const h = document.createElement("div");
    h.className="floating-heart"; h.innerText="ðŸ’–";
    h.style.left = Math.random()*100+"%"; h.style.top = "70%";
    document.body.appendChild(h);
    setTimeout(()=>h.remove(), 1500);
  }
  setTimeout(() => notify.remove(), 3000);
}

// --- WORDLE OYUN MANTIÄžI ---
const wordList = [
  "GÃœNEÅž", "SEVGÄ°", "DENÄ°Z", "MELEK", "RÃœZGA", "DÃœNYA", "Ã‡Ä°Ã‡EK", "BAHAR", "HAYAT",
  "NEFES", "BULUT", "IÅžIKL", "HUZUR", "BEYAZ", "PEMBE", "GÃ–NÃœL", "SABAH", "MASAL", 
  "ÅžEKER", "BALIM", "CANIM", "AÅžKIM", "YOLCU", "ORMAN", "TOPRA", "Ä°NCÄ°M", "GÃœLÃœM"
];

function getDailyWord() {
    const now = new Date();
    const start = new Date(now.getFullYear(), 0, 0);
    const diff = now - start;
    const dayOfYear = Math.floor(diff / (1000 * 60 * 60 * 24));
    return wordList[dayOfYear % wordList.length].toUpperCase();
}

const targetWord = getDailyWord();
let currentRow = 0;
let currentGuess = "";

const gridDiv = document.getElementById("grid");
for (let i = 0; i < 6; i++) {
    const row = document.createElement("div"); row.className = "row";
    for (let j = 0; j < 5; j++) {
        const tile = document.createElement("div"); tile.className = "tile";
        row.appendChild(tile);
    }
    gridDiv.appendChild(row);
}

const keys = [
    ["E", "R", "T", "Y", "U", "I", "O", "P", "Äž", "Ãœ"],
    ["A", "S", "D", "F", "G", "H", "J", "K", "L", "Åž", "Ä°"],
    ["ENTER", "Z", "C", "V", "B", "N", "M", "Ã–", "Ã‡", "âŒ«"]
];

keys.forEach((row, rowIndex) => {
    const container = document.getElementById(`kbd-row${rowIndex + 1}`);
    row.forEach(key => {
        const btn = document.createElement("button");
        btn.innerText = key;
        btn.className = "key" + (key.length > 1 ? " wide" : "");
        btn.id = "key-" + key.toUpperCase();
        btn.onclick = () => handleInput(key);
        container.appendChild(btn);
    });
});

function handleInput(key) {
    if (key === "ENTER") {
        if (currentGuess.length === 5) submitGuess();
    } else if (key === "âŒ«" || key === "BACKSPACE") {
        currentGuess = currentGuess.slice(0, -1);
    } else if (currentGuess.length < 5 && /^[A-ZÄžÃœÅžÄ°Ã–Ã‡]$/i.test(key)) {
        currentGuess += key.toUpperCase();
    }
    updateUI();
}

document.addEventListener("keydown", (e) => {
    let k = e.key.toUpperCase();
    if (k === "BACKSPACE") k = "âŒ«";
    if (k === "I") k = "Ä°"; // TÃ¼rkÃ§e klavye dÃ¼zeltmesi
    handleInput(k);
});

function updateUI() {
    const rows = document.querySelectorAll(".row");
    const tiles = rows[currentRow].querySelectorAll(".tile");
    tiles.forEach((tile, i) => { tile.innerText = currentGuess[i] || ""; });
}

function submitGuess() {
    const rows = document.querySelectorAll(".row");
    const tiles = rows[currentRow].querySelectorAll(".tile");
    let targetArr = targetWord.split("");
    let guessArr = currentGuess.split("");

    guessArr.forEach((char, i) => {
        const keyBtn = document.getElementById("key-" + char);
        if (char === targetArr[i]) {
            tiles[i].classList.add("correct");
            if (keyBtn) { keyBtn.classList.remove("present", "absent"); keyBtn.classList.add("correct"); }
            targetArr[i] = null; guessArr[i] = null;
        }
    });

    guessArr.forEach((char, i) => {
        if (char) {
            const keyBtn = document.getElementById("key-" + char);
            const index = targetArr.indexOf(char);
            if (index !== -1) {
                tiles[i].classList.add("present");
                if (keyBtn && !keyBtn.classList.contains("correct")) keyBtn.classList.add("present");
                targetArr[index] = null;
            } else {
                tiles[i].classList.add("absent");
                if (keyBtn && !keyBtn.classList.contains("correct") && !keyBtn.classList.contains("present")) keyBtn.classList.add("absent");
            }
        }
    });

    if (currentGuess === targetWord) {
        document.getElementById("message").innerText = "HarikasÄ±n! BugÃ¼nÃ¼n kelimesini bildin ðŸ’–";
        const petRef = ref(db, `rooms/${room}/pet`);
        onValue(petRef, (s) => {
            const d = s.val() || {bond: 0};
            update(petRef, { bond: d.bond + 20 });
        }, { onlyOnce: true });
    } else {
        currentRow++;
        currentGuess = "";
        if (currentRow === 6) document.getElementById("message").innerText = "YarÄ±n tekrar dene! Kelime: " + targetWord;
    }
}
</script>
</body>
</html>
