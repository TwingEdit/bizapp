<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, push, onChildAdded, get } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AZaSyCwUGShLfuUOSSHSyK0b7HXvPiu45Mtso",
  authDomain: "sadece-biz.firebaseapp.com",
  databaseURL: "https://sadece-biz-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "sadece-biz",
  storageBucket: "sadece-biz.firebasestorage.app",
  messagingSenderId: "868755199002",
  appId: "1:868755199002:web:e8c18eb0cd11abb2292da3"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ODA */
let room = localStorage.getItem("room") || "genel";
room = room.trim().toLowerCase();
const roomRef = ref(db, "rooms/" + room);

/* USER ID */
let userId = localStorage.getItem("userId");
if (!userId) {
  userId = Math.random().toString(36).substring(2, 10);
  localStorage.setItem("userId", userId);
}

document.getElementById("msg").innerText = "BaÄŸlandÄ± ðŸ’ž";

/* Ã–PÃœCÃœK GÃ–NDER */
window.kiss = function () {
  push(roomRef, {
    sender: userId,
    time: Date.now()
  });
};

/* Ä°lk mevcut veriyi al */
get(roomRef).then((snapshot) => {
  // Mevcut veriyi okuduk â†’ artÄ±k yeni gelenleri dinle
  onChildAdded(roomRef, (snap) => {
    const data = snap.val();

    // EÄŸer bu mesaj bizim deÄŸilse gÃ¶ster
    if (data.sender !== userId) {
      document.getElementById("msg").innerText = "ðŸ’‹ Seni Ã–ptÃ¼!";

      // 3 saniye sonra sÃ¼re yazar
      setTimeout(() => {
        const nowSec = Math.floor((Date.now() - data.time) / 1000);
        document.getElementById("msg").innerText = `ðŸ’‹ Ã–pÃ¼lme ${nowSec} saniye Ã¶nce`;
      }, 3000);
    }
  });
});
</script>
