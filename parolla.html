<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Taha- Parolla</title>
  <style>
    :root { --bg: #121213; --text: #d7dadc; --correct: #6aaa64; --wrong: #ff4d6d; --active: #4cc9f0; --passed: #f9c74f; --main-pink: #ff4d6d; }
    body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); display: flex; flex-direction: column; align-items: center; justify-content: center; margin: 0; padding: 10px; height: 100vh; overflow: hidden; }
    .back-btn { position: fixed; top: 20px; left: 20px; background: white; border: none; padding: 10px 15px; border-radius: 12px; cursor: pointer; color: var(--main-pink); font-weight: bold; text-decoration: none; box-shadow: 0 4px 10px rgba(0,0,0,0.1); z-index: 9999; }
    #wheel-container { position: relative; width: 310px; height: 310px; margin-bottom: 20px; flex-shrink: 0; }
    .letter { position: absolute; width: 32px; height: 32px; border-radius: 50%; background: #3a3a3c; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 13px; transition: 0.3s; color: white; }
    .active { border: 3px solid white; transform: scale(1.3); z-index: 10; box-shadow: 0 0 15px var(--active); }
    .correct { background-color: var(--correct) !important; color: white !important; }
    .wrong { background-color: var(--wrong) !important; color: white !important; }
    .passed { background-color: var(--passed) !important; color: #333 !important; }
    #question-card { width: 100%; max-width: 600px; display: flex; flex-direction: column; align-items: center; }
    #question-text { font-size: 22px; font-weight: 800; min-height: 80px; text-align: center; margin-bottom: 20px; text-transform: uppercase; color: #fff; padding: 0 15px; }
    input { width: 80%; padding: 15px; background: transparent; border: none; border-bottom: 3px solid #3a3a3c; color: white; font-size: 24px; text-align: center; text-transform: uppercase; outline: none; }
    .btn-group { display: flex; gap: 20px; width: 80%; justify-content: center; margin-top: 25px; }
    button.action-btn { flex: 1; padding: 18px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; text-transform: uppercase; }
    .btn-check { background: var(--correct); color: white; }
    .btn-pass { background: var(--passed); color: #333; }
    .results-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: var(--bg); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 10000; }
    .kiss-notify { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: white; color: var(--main-pink); padding: 15px 25px; border-radius: 50px; font-weight: bold; box-shadow: 0 10px 25px rgba(255, 77, 109, 0.3); z-index: 10001; display: flex; align-items: center; gap: 10px; animation: slideDown 0.5s ease-out; }
    @keyframes slideDown { from { top: -100px; } to { top: 20px; } }
    .floating-heart { position: fixed; color: var(--main-pink); pointer-events: none; animation: heartPop 1.5s forwards; z-index: 10002; font-size: 25px; }
    @keyframes heartPop { 0% { transform: scale(0); opacity: 0; } 100% { transform: translateY(-150px) rotate(20deg) scale(1.5); opacity: 0; } }
  </style>
</head>
<body>
  <a href="menu.html" class="back-btn">â¬… Geri</a>
  <div id="wheel-container"></div>
  <div id="question-card">
    <div id="question-text">YÃœKLENÄ°YOR...</div>
    <input type="text" id="answer-input" placeholder="CEVABI YAZIN" autocomplete="off">
    <div class="btn-group">
      <button class="action-btn btn-pass" onclick="handlePass()">PAS</button>
      <button class="action-btn btn-check" onclick="handleCheck()">CEVAPLA</button>
    </div>
  </div>
  <div id="results-screen" class="results-overlay">
    <h2 style="color: var(--active); font-size: 32px;">OYUN BÄ°TTÄ°</h2>
    <div id="stats-summary" style="font-size: 24px; margin-bottom: 30px;"></div>
    <button class="action-btn btn-check" onclick="location.reload()">YENÄ°DEN BAÅžLA</button>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, onChildAdded } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AZaSyCwUGShLfuUOSSHSyK0b7HXvPiu45Mtso",
  authDomain: "sadece-biz.firebaseapp.com",
  databaseURL: "https://sadece-biz-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "sadece-biz",
  storageBucket: "sadece-biz.firebasestorage.app",
  appId: "1:868755199002:web=e8c18eb0cd11abb2292da3"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
let room = localStorage.getItem("room") || "genel";
let userId = localStorage.getItem("userId");

// DÄ°KKAT: Sadece Ã–PÃœCÃœKLERÄ° dinleyen Ã¶zel alt yol
const kissOnlyRef = ref(db, `rooms/${room}/kisses`);

onChildAdded(kissOnlyRef, (snapshot) => {
  const data = snapshot.val();
  const simdi = Date.now();
  // Sadece son 10 saniye iÃ§inde baÅŸkasÄ±ndan gelen Ã¶pÃ¼cÃ¼kler
  if (data && data.sender !== userId && (simdi - data.time < 10000)) {
    const existing = document.querySelector(".kiss-notify");
    if(existing) existing.remove();
    const notify = document.createElement("div");
    notify.className = "kiss-notify";
    notify.innerHTML = `<span>ðŸ’‹</span> BalÄ±m seni Ã¶ptÃ¼!`;
    document.body.appendChild(notify);
    for(let i=0; i<15; i++) {
        const h = document.createElement("div");
        h.className="floating-heart"; h.innerText="ðŸ’–";
        h.style.left = Math.random()*100+"%"; h.style.top = "70%";
        document.body.appendChild(h);
        setTimeout(()=>h.remove(), 1500);
    }
    setTimeout(() => { if(notify) notify.remove(); }, 3000);
  }
});
</script>

<script>
// Buradaki oyun mantÄ±ÄŸÄ± Firebase'e yazÄ± yazmadÄ±ÄŸÄ± iÃ§in karÄ±ÅŸÄ±klÄ±k Ã§Ä±karmaz.
const alphabet = ["A", "B", "C", "Ã‡", "D", "E", "F", "G", "Äž", "H", "I", "Ä°", "J", "K", "L", "M", "N", "O", "Ã–", "P", "R", "S", "Åž", "T", "U", "Ãœ", "V", "Y", "Z"];
const questionBank = { "A": {q: "IÅžIK SAÃ‡ACAK BEYAZLIÄžA VARINCAYA KADAR ISITILMIÅž OLAN?", a: "AKKOR"}, "B": {q: "DOÄžANIN CANLANDIÄžI MEVSÄ°M VE SEVGÄ°LÄ°N?", a: "BAHAR"}, "C": {q: "BÄ°R SORUYA VERÄ°LEN KARÅžILIK?", a: "CEVAP"}, "Ã‡": {q: "HÃœCRENÄ°N YÃ–NETÄ°M MERKEZÄ°?", a: "Ã‡EKÄ°RDEK"}, "D": {q: "GENETÄ°K ÅžÄ°FRE TAÅžIYAN MOLEKÃœL?", a: "DNA"}, "E": {q: "Ä°Åž YAPABÄ°LME YETENEÄžÄ°?", a: "ENERJÄ°"}, "F": {q: "BÄ°TKÄ°LERÄ°N BESÄ°N ÃœRETMESÄ°?", a: "FOTOSENTEZ"}, "G": {q: "ISI VE IÅžIK KAYNAÄžIMIZ?", a: "GÃœNEÅž"}, "Äž": {q: "MAVÄ° BOÅžLUK, GÃ–K?", a: "GÃ–KYÃœZÃœ"}, "H": {q: "YAÅžAMIN EN KÃœÃ‡ÃœK BÄ°RÄ°MÄ°?", a: "HÃœCRE"}, "I": {q: "ETRAFI AYDINLATAN ENERJÄ°?", a: "IÅžIK"}, "Ä°": {q: "VÃœCUDUN KEMÄ°K Ã‡ATISI?", a: "Ä°SKELET"}, "J": {q: "GÃœÃ‡ KAYNAÄžI?", a: "JENERATÃ–R"}, "K": {q: "DEÄžÄ°ÅžMEYEN MADDE MÄ°KTARI?", a: "KÃœTLE"}, "L": {q: "BÄ°LÄ°MSEL Ã‡ALIÅžMA ALANI?", a: "LABORATUVAR"}, "M": {q: "DEMÄ°RÄ° Ã‡EKEN MADDE?", a: "MIKNATIS"}, "N": {q: "SOLUNAN HAVA?", a: "NEFES"}, "O": {q: "TEMEL YAÅžAM GAZI?", a: "OKSÄ°JEN"}, "Ã–": {q: "KÃœTLE / HACÄ°M?", a: "Ã–ZKÃœTLE"}, "P": {q: "GEZEGEN?", a: "PLANET"}, "R": {q: "RÃœZGAR?", a: "RÃœZGAR"}, "S": {q: "AKIÅžKAN HAL?", a: "SIVI"}, "Åž": {q: "BÃœYÃœK YERLEÅžÄ°M YERÄ°?", a: "ÅžEHÄ°R"}, "T": {q: "SICAKLIK Ã–LÃ‡ER?", a: "TERMOMETRE"}, "U": {q: "SONSUZ BOÅžLUK?", a: "UZAY"}, "Ãœ": {q: "MAL MEYDANA GETÄ°RME?", a: "ÃœRETÄ°M"}, "V": {q: "DÄ°RENÃ‡ ARTIRICI?", a: "VÄ°TAMÄ°N"}, "Y": {q: "SU DAMLALARININ DÃœÅžMESÄ°?", a: "YAÄžMUR"}, "Z": {q: "AKIP GÄ°DEN SÃœREÃ‡?", a: "ZAMAN"} };
let currentIndex = 0; let results = {}; let visitCount = {};
function initGame() {
    const container = document.getElementById("wheel-container");
    alphabet.forEach((letter, i) => {
        visitCount[letter] = 0;
        const angle = (i / alphabet.length) * (2 * Math.PI) - (Math.PI / 2);
        const x = 155 + 130 * Math.cos(angle) - 16;
        const y = 155 + 130 * Math.sin(angle) - 16;
        const div = document.createElement("div");
        div.className = "letter"; div.id = `l-${letter}`; div.innerText = letter;
        div.style.left = `${x}px`; div.style.top = `${y}px`;
        container.appendChild(div);
    });
    updateUI();
}
function updateUI() {
    const letter = alphabet[currentIndex];
    visitCount[letter]++;
    document.querySelectorAll(".letter").forEach(el => el.classList.remove("active"));
    document.getElementById(`l-${letter}`).classList.add("active");
    document.getElementById("question-text").innerText = questionBank[letter].q;
    document.getElementById("answer-input").value = "";
    document.getElementById("answer-input").focus();
}
window.handleCheck = function() {
    const input = document.getElementById("answer-input").value.trim().toUpperCase();
    const letter = alphabet[currentIndex];
    if (input === questionBank[letter].a) {
        document.getElementById(`l-${letter}`).classList.add("correct");
        results[letter] = "correct";
    } else {
        document.getElementById(`l-${letter}`).classList.add("wrong");
        results[letter] = "wrong";
    }
    findNext();
};
window.handlePass = function() {
    document.getElementById(`l-${alphabet[currentIndex]}`).classList.add("passed");
    findNext();
};
function findNext() {
    let start = currentIndex;
    while (true) {
        currentIndex = (currentIndex + 1) % alphabet.length;
        if (!results[alphabet[currentIndex]]) { updateUI(); return; }
        if (currentIndex === start) { showFinalResults(); return; }
    }
}
function showFinalResults() {
    document.getElementById("results-screen").style.display = "flex";
    const c = Object.values(results).filter(v => v === "correct").length;
    document.getElementById("stats-summary").innerText = `DOÄžRU: ${c} | YANLIÅž: ${Object.values(results).length - c}`;
}
document.getElementById("answer-input").addEventListener("keypress", (e) => { if (e.key === "Enter") handleCheck(); });
initGame();
</script>
</body>
</html>
