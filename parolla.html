<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BizApp - Parolla</title>
  <style>
    :root {
      --primary: #ff4d6d;
      --bg: #121213;
      --correct: #6aaa64;
      --wrong: #ff4d6d;
      --active: #4cc9f0;
      --passed: #f9c74f;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      padding: 10px;
      height: 100vh;
      overflow: hidden;
    }

    .header { width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 10px; }
    .back-link { color: var(--primary); text-decoration: none; font-weight: bold; }

    #wheel-container {
      position: relative;
      width: 310px;
      height: 310px;
      margin: 20px 0;
      flex-shrink: 0;
    }

    .letter {
      position: absolute;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #3a3a3c;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 13px;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }

    .active { 
      background: var(--active); 
      transform: scale(1.3); 
      box-shadow: 0 0 15px var(--active); 
      border-color: white; 
      z-index: 5;
    }

    .correct { background: var(--correct) !important; }
    .wrong { background: var(--wrong) !important; }
    .passed { background: var(--passed) !important; color: #333; }

    #question-card {
      background: #1e1e1e;
      padding: 20px;
      border-radius: 25px;
      width: 90%;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      border-bottom: 5px solid var(--active);
    }

    #letter-info { font-weight: bold; color: var(--active); font-size: 22px; margin-bottom: 5px; }
    #question-text { font-size: 17px; margin-bottom: 20px; min-height: 50px; line-height: 1.4; }
    
    input {
      width: 80%;
      padding: 12px;
      border-radius: 12px;
      border: 2px solid #333;
      background: #2c2c2e;
      color: white;
      font-size: 18px;
      text-align: center;
      text-transform: uppercase;
      outline: none;
      margin-bottom: 15px;
    }

    .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    button { padding: 12px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; }
    .btn-check { background: var(--correct); color: white; }
    .btn-pass { background: var(--passed); color: #333; }
  </style>
</head>
<body>

  <div class="header">
    <a href="menu.html" class="back-link">⬅ Menü</a>
    <div id="score-display">Doğru: 0 | Yanlış: 0</div>
  </div>

  <div id="wheel-container"></div>

  <div id="question-card">
    <div id="letter-info">A HARFİ</div>
    <div id="question-text">Soru yükleniyor...</div>
    <input type="text" id="answer-input" placeholder="Cevabı yaz..." autocomplete="off">
    <div class="btn-group">
      <button class="btn-pass" onclick="handlePass()">PAS</button>
      <button class="btn-check" onclick="handleCheck()">CEVAPLA</button>
    </div>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, update, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AZaSyCwUGShLfuUOSSHSyK0b7HXvPiu45Mtso",
  authDomain: "sadece-biz.firebaseapp.com",
  databaseURL: "https://sadece-biz-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "sadece-biz",
  storageBucket: "sadece-biz.firebasestorage.app",
  messagingSenderId: "868755199002",
  appId: "1:868755199002:web=e8c18eb0cd11abb2292da3"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const room = localStorage.getItem("room") || "genel";

const alphabet = ["A", "B", "C", "Ç", "D", "E", "F", "G", "H", "I", "İ", "J", "K", "L", "M", "N", "O", "Ö", "P", "R", "S", "Ş", "T", "U", "Ü", "V", "Y", "Z"];
const questions = {
  "A": { q: "Sana olan duygumun en saf hali?", a: "AŞK" },
  "B": { q: "Aşkımızın başladığı mevsim?", a: "BAHAR" },
  "C": { q: "Kalbimin diğer yarısı?", a: "CANIM" },
  "Ç": { q: "Birlikte içtiğimiz en tatlı şey?", a: "ÇAY" },
  "D": { q: "Gözlerin kadar derin olan mavilik?", a: "DENİZ" },
  "E": { q: "Seninle kurduğumuz sıcak yuva?", a: "EVİMİZ" },
  "F": { q: "Karanlığımı aydınlatan gülüşün?", a: "FENER" },
  "G": { q: "Her sabah içimi ısıtan?", a: "GÜNEŞ" },
  "H": { q: "Senin yanında bulduğum huzur?", a: "HUZUR" },
  "I": { q: "Gecemize sızan ayın hediyesi?", a: "IŞIK" },
  "İ": { q: "Aşkımızın en güzel şehri?", a: "İSTANBUL" },
  "J": { q: "Şansımızın simgesi oyun kartı?", a: "JOKER" },
  "K": { q: "Seni her gördüğümde hızlanan?", a: "KALP" },
  "L": { q: "Zarafetin simgesi olan çiçek?", a: "LALE" },
  "M": { q: "Ruhumun eşi, sevgilim?", a: "MELEĞİM" },
  "N": { q: "Sen olmayınca kesilen şey?", a: "NEFES" },
  "O": { q: "Bizim hikayemiz koca bir...?", a: "OKYANUS" },
  "Ö": { q: "Uzakken kalbimi sızlatan?", a: "ÖZLEM" },
  "P": { q: "Geleceğimiz kadar renkli bir renk?", a: "PEMBE" },
  "R": { q: "Uykuda seninle olduğum yer?", a: "RÜYA" },
  "S": { q: "Seni sevme sürem?", a: "SONSUZ" },
  "Ş": { q: "Gözlerindeki o tatlı pırıltı?", a: "ŞEKER" },
  "T": { q: "Dudaklarındaki o eşsiz lezzet?", a: "TATLI" },
  "U": { q: "Geleceğe dair beslediğimiz?", a: "UMUT" },
  "Ü": { q: "Ayrılık kelimesinin yarattığı his?", a: "ÜZÜNTÜ" },
  "V": { q: "Bizim lugatımızda olmayan kelime?", a: "VEDA" },
  "Y": { q: "Hayatımdaki en güzel...?", a: "YAZIM" },
  "Z": { q: "Aşkın en kıymetli, en saf hali?", a: "ZÜMRÜT" }
};

let currentIndex = 0;
let results = {}; // correct, wrong
let corrects = 0;
let wrongs = 0;

function initWheel() {
  const container = document.getElementById("wheel-container");
  const radius = 130;
  alphabet.forEach((letter, i) => {
    const angle = (i / alphabet.length) * (2 * Math.PI) - (Math.PI / 2);
    const x = 155 + radius * Math.cos(angle) - 16;
    const y = 155 + radius * Math.sin(angle) - 16;
    const div = document.createElement("div");
    div.className = "letter"; div.id = `l-${letter}`; div.innerText = letter;
    div.style.left = `${x}px`; div.style.top = `${y}px`;
    container.appendChild(div);
  });
  updateUI();
}

function updateUI() {
  const currentLetter = alphabet[currentIndex];
  document.querySelectorAll(".letter").forEach(el => el.classList.remove("active"));
  document.getElementById(`l-${currentLetter}`).classList.add("active");
  document.getElementById("letter-info").innerText = `${currentLetter} HARFİ`;
  document.getElementById("question-text").innerText = questions[currentLetter].q;
  document.getElementById("score-display").innerText = `Doğru: ${corrects} | Yanlış: ${wrongs}`;
}

window.handleCheck = function() {
  const input = document.getElementById("answer-input").value.trim().toUpperCase();
  const currentLetter = alphabet[currentIndex];
  const el = document.getElementById(`l-${currentLetter}`);

  if (input === questions[currentLetter].a.toUpperCase()) {
    el.classList.add("correct");
    results[currentLetter] = "correct";
    corrects++;
    addBond(10);
  } else {
    el.classList.add("wrong");
    results[currentLetter] = "wrong";
    wrongs++;
  }
  document.getElementById("answer-input").value = "";
  moveToNext();
};

window.handlePass = function() {
  document.getElementById("answer-input").value = "";
  moveToNext();
};

function moveToNext() {
  let count = 0;
  while (count < alphabet.length) {
    currentIndex = (currentIndex + 1) % alphabet.length;
    if (!results[alphabet[currentIndex]]) {
      updateUI();
      return;
    }
    count++;
  }
  finishGame();
}

function addBond(pts) {
  const petRef = ref(db, `rooms/${room}/pet`);
  onValue(petRef, (s) => {
    const d = s.val() || {bond: 0};
    update(petRef, { bond: d.bond + pts });
  }, { onlyOnce: true });
}

function finishGame() {
  document.getElementById("question-card").innerHTML = `<h3>Oyun Bitti! ✨</h3><p>${corrects} Doğru ile harika iş çıkardınız!</p><button onclick="location.reload()" style="background:var(--active); color:white; width:100%">Yeniden Oyna</button>`;
}

document.getElementById("answer-input").addEventListener("keypress", (e) => { if (e.key === "Enter") handleCheck(); });
initWheel();
</script>
</body>
</html>
