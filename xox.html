<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BizApp - Online XOX</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    :root {
      --bg: #121213;
      --cell-bg: #1e1e1e;
      --text: #ffffff;
      --x-color: #ff4d6d;
      --o-color: #4cc9f0;
    }
    body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
    .back-btn { position: fixed; top: 20px; left: 20px; background: white; color: #ff4d6d; padding: 10px 15px; border-radius: 12px; text-decoration: none; font-weight: bold; }
    
    .scoreboard { display: flex; gap: 30px; margin-bottom: 20px; background: #2a2a2a; padding: 15px; border-radius: 20px; }
    .score-item { text-align: center; }
    
    .board { display: grid; grid-template-columns: repeat(3, 90px); gap: 10px; }
    .cell { width: 90px; height: 90px; background: var(--cell-bg); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 40px; font-weight: bold; cursor: pointer; }
    .cell.x { color: var(--x-color); }
    .cell.o { color: var(--o-color); }
    .cell.winner { background: #6aaa64; }
    
    #status { margin: 20px 0; font-weight: bold; height: 25px; }
    #reset-btn { padding: 10px 20px; background: transparent; border: 2px solid white; color: white; border-radius: 8px; cursor: pointer; }
  </style>
</head>
<body>

  <a href="menu.html" class="back-btn">⬅ Geri</a>

  <div class="scoreboard">
    <div class="score-item">X (Skor)<br><span id="score-x">0</span></div>
    <div class="score-item">O (Skor)<br><span id="score-o">0</span></div>
  </div>

  <div id="status">Bağlanılıyor...</div>

  <div class="board" id="board">
    <div class="cell" data-index="0"></div>
    <div class="cell" data-index="1"></div>
    <div class="cell" data-index="2"></div>
    <div class="cell" data-index="3"></div>
    <div class="cell" data-index="4"></div>
    <div class="cell" data-index="5"></div>
    <div class="cell" data-index="6"></div>
    <div class="cell" data-index="7"></div>
    <div class="cell" data-index="8"></div>
  </div>

  <button id="reset-btn" style="margin-top:20px">OYUNU SIFIRLA</button>

  <script>
    // --- BURAYA DİKKAT ---
    // Eğer projende başka bir yerde firebaseConfig varsa onu buraya yapıştır!
    const firebaseConfig = {
      apiKey: "AIza...",
      databaseURL: "https://senin-projen.firebaseio.com",
      projectId: "senin-projen",
      // ... diğer bilgiler
    };
    
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const roomName = localStorage.getItem("room") || "genel_oda";
    const gameRef = database.ref('rooms/' + roomName + '/xox');

    let localGameState = Array(9).fill("");
    let currentTurn = "X";

    // Veritabanını Dinle (Diğer oyuncu basınca senin ekranın değişir)
    gameRef.on('value', (snapshot) => {
      const data = snapshot.val();
      if (data) {
        localGameState = data.board || Array(9).fill("");
        currentTurn = data.turn || "X";
        updateUI(data.scores || {X:0, O:0});
      }
    });

    function updateUI(scores) {
      const cells = document.querySelectorAll('.cell');
      localGameState.forEach((val, i) => {
        cells[i].innerText = val;
        cells[i].className = "cell " + val.toLowerCase();
      });
      document.getElementById('status').innerText = "Sıra: " + currentTurn;
      document.getElementById('score-x').innerText = scores.X;
      document.getElementById('score-o').innerText = scores.O;
    }

    // Hücreye tıklama
    document.querySelectorAll('.cell').forEach(cell => {
      cell.addEventListener('click', () => {
        const idx = cell.getAttribute('data-index');
        if (localGameState[idx] === "" && currentTurn) {
          localGameState[idx] = currentTurn;
          const nextTurn = currentTurn === "X" ? "O" : "X";
          
          // Veritabanını güncelle (İki cihazda da anında değişir)
          gameRef.update({
            board: localGameState,
            turn: nextTurn
          });
          
          checkWinnerLocally();
        }
      });
    });

    function checkWinnerLocally() {
        const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
        for (let [a, b, c] of wins) {
            if (localGameState[a] && localGameState[a] === localGameState[b] && localGameState[a] === localGameState[c]) {
                alert(localGameState[a] + " KAZANDI!");
                // Kazanan skoru artır ve board'u temizle mantığı buraya eklenebilir
                resetGameData();
                break;
            }
        }
    }

    document.getElementById('reset-btn').onclick = resetGameData;

    function resetGameData() {
      gameRef.update({
        board: Array(9).fill(""),
        turn: "X"
      });
    }
  </script>
</body>
</html>
